<!DOCTYPE html>
<html>
    <head>
        <title>Organization Profile - OrgSpace</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <main>
            <nav id="menu">
                <span class="menu-title">DLSU Organizations</span>
                <input type="checkbox" id="responsive-menu"><label></label>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a class="dropdown-arrow" href="#organizations">Organizations</a>
                        <ul class="sub-menus">
                            <li><a href="org1.html">Archers for UNICEF</a></li>
                            <li><a href="org2.html">Council of Student Organizations</a></li>
                            <li><a href="org3.html">Information Security Organization</a></li>
                            <li><a href="org4.html">La Salle Computer Society</a></li>
                            <li><a href="org5.html">Management of Financial Institutions Association</a></li>
                        </ul>
                    </li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li class="menu-profile" id="profileMenu">
                        <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
                        <img src="assets/profile-icon.png" alt="Account" class="profile-icon">
                        </button>
                        <ul class="profile-dropdown" id="profileDropdown" role="menu" aria-label="Account menu"></ul>
                    </li>
                </ul>
            </nav>

            <div class="profile-container" id="profileContent" style="display: none;">
                <!-- Organization Header -->
                <div class="profile-header" style="display: flex; align-items: center; gap: 30px;">
                    <img id="orgLogo" src="" alt="Organization Logo" class="profile-pic-large">
                    <div>
                        <h1 id="orgName" style="color: white; margin-bottom: 10px;"></h1>
                        <p id="orgTagline" style="font-size: 1.1rem; opacity: 0.9;"></p>
                        <div class="profile-actions">
                            <button onclick="openEditModal()" class="btn-action">‚úèÔ∏è Edit Profile</button>
                            <button onclick="managePosts()" class="btn-action">üìù Manage Posts</button>
                            <button onclick="viewAnalytics()" class="btn-action">üìä View Analytics</button>
                        </div>
                    </div>
                </div>

                <!-- Stats Overview -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div>üë•</div>
                        <h4 id="membersCount">0</h4>
                        <p>Total Members</p>
                    </div>
                    <div class="stat-card">
                        <div>üìÖ</div>
                        <h4 id="eventsCount">0</h4>
                        <p>Upcoming Events</p>
                    </div>
                    <div class="stat-card">
                        <div>üí¨</div>
                        <h4 id="postsCount">0</h4>
                        <p>Total Posts</p>
                    </div>
                </div>

                <!-- Organization Information Grid -->
                <div class="info-grid">
                    <!-- About Section -->
                    <div class="info-card">
                        <h3>About Us</h3>
                        <p id="orgDescription"></p>
                        <div style="margin-top: 20px;">
                            <h4 style="color: #046307; margin-bottom: 10px;">Organization Type</h4>
                            <span class="tag" id="orgType"></span>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="info-card">
                        <h3>Contact Information</h3>
                        <p><strong>üìß Email:</strong> <span id="contactEmail"></span></p>
                        <p><strong>üì± Contact:</strong> <span id="contactPhone"></span></p>
                        <p><strong>üëë President:</strong> <span id="orgPresident"></span></p>
                        <p><strong>üëë Vice President:</strong> <span id="orgVP"></span></p>
                        <div style="margin-top: 20px;">
                            <h4 style="color: #046307; margin-bottom: 10px;">Social Media</h4>
                            <div id="socialMediaTags"></div>
                        </div>
                    </div>

                    <!-- Key Members -->
                    <div class="info-card">
                        <h3>Key Members</h3>
                        <ul class="members-list" id="keyMembersList"></ul>
                    </div>

                    <!-- Recent Activities -->
                    <div class="info-card">
                        <h3>Recent Activities</h3>
                        <div id="recentActivities">
                            <p>üéØ <strong>2nd General Assembly</strong> - Jan 21, 2026</p>
                            <p>ü§ù <strong>World Children's Day</strong> - Nov 20, 2025</p>
                            <p>üåü <strong>MAUgic in Motion Workshop</strong> - Nov 22, 2025</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="background: #e9f5e9; padding: 25px; border-radius: 14px; border: 2px solid #046307; margin-top: 30px;">
                    <h3 style="color: #046307; margin-bottom: 15px;">Quick Actions</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="createNewPost()" class="btn-action">üì¢ Create New Post</button>
                        <button onclick="manageEvents()" class="btn-action">üìÖ Manage Events</button>
                        <button onclick="viewMembers()" class="btn-action">üë• View All Members</button>
                        <button onclick="downloadReports()" class="btn-action">üìä Download Reports</button>
                    </div>
                </div>
            </div>

            <div id="loadingMessage" style="text-align: center; padding: 50px;">
                <p>Loading organization profile...</p>
            </div>

            <!-- Edit Profile Modal -->
            <div id="editModal" class="modal-overlay">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeEditModal()">&times;</span>
                    <h2>Edit Organization Profile</h2>
                    <form id="editOrgForm">
                        <div class="form-group">
                            <label>Organization Name</label>
                            <input type="text" id="editOrgName">
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="editOrgDesc" rows="4"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>President</label>
                                <input type="text" id="editPresident">
                            </div>
                            <div class="form-group">
                                <label>Vice President</label>
                                <input type="text" id="editVicePresident">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Contact Email</label>
                            <input type="email" id="editContactEmail">
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" onclick="closeEditModal()" class="btn-secondary">Cancel</button>
                            <button type="button" onclick="saveOrgProfile()" class="btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- First, load the auth-guard.js file -->
            <script src="script.js"></script>
            <script>
                // Use AuthGuard to protect this page
                document.addEventListener('DOMContentLoaded', function() {
                    try {
                        const userInfo = AuthGuard.protectPage('organization');
                        
                        if (userInfo) {
                            // Auth successful, show content
                            document.getElementById('loadingMessage').style.display = 'none';
                            document.getElementById('profileContent').style.display = 'block';
                            
                            // Initialize profile with user data
                            initializeProfile(userInfo.user);
                        }
                    } catch (error) {
                        console.error('Profile error:', error);
                        document.getElementById('loadingMessage').innerHTML = 
                            '<p style="color: #d32f2f;">Error loading profile. Redirecting...</p>';
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    }
                });

                function initializeProfile(user) {
                    // Demo organization data
                    const orgData = {
                        name: user.orgName || "Archers for UNICEF",
                        tagline: "Always for the women and children",
                        description: "Archers for UNICEF is a DLSU-based organization committed to supporting UNICEF initiatives and empowering students to advocate for women and children's rights through meaningful events, partnerships, and outreach programs.",
                        type: "Volunteer Organization",
                        contactEmail: user.email || "au@dlsu.edu.ph",
                        contactPhone: "+63 912 345 6789",
                        president: "John Smith",
                        vicePresident: "Sarah Lee",
                        membersCount: 150,
                        eventsCount: 3,
                        postsCount: 3,
                        socialMedia: {
                            facebook: "facebook.com/ArchersForUNICEF",
                            twitter: "@ArchersForUNICEF",
                            instagram: "@archersforunicef_dlsu"
                        },
                        keyMembers: [
                            { name: "John Smith", role: "President" },
                            { name: "Sarah Lee", role: "Vice President" },
                            { name: "Michael Tan", role: "Secretary" },
                            { name: "Lisa Garcia", role: "Treasurer" },
                            { name: "David Chen", role: "Tech Lead" }
                        ]
                    };

                    // Populate organization data with XSS protection
                    document.getElementById('orgLogo').src = "assets/au_logo1.png";
                    document.getElementById('orgName').textContent = escapeHtml(orgData.name);
                    document.getElementById('orgTagline').textContent = escapeHtml(orgData.tagline);
                    document.getElementById('orgDescription').textContent = escapeHtml(orgData.description);
                    document.getElementById('orgType').textContent = escapeHtml(orgData.type);
                    document.getElementById('contactEmail').textContent = escapeHtml(orgData.contactEmail);
                    document.getElementById('contactPhone').textContent = escapeHtml(orgData.contactPhone);
                    document.getElementById('orgPresident').textContent = escapeHtml(orgData.president);
                    document.getElementById('orgVP').textContent = escapeHtml(orgData.vicePresident);
                    document.getElementById('membersCount').textContent = escapeHtml(orgData.membersCount.toString());
                    document.getElementById('eventsCount').textContent = escapeHtml(orgData.eventsCount.toString());
                    document.getElementById('postsCount').textContent = escapeHtml(orgData.postsCount.toString());

                    // Populate social media tags with XSS protection
                    const socialContainer = document.getElementById('socialMediaTags');
                    Object.entries(orgData.socialMedia).forEach(([platform, handle]) => {
                        const tag = document.createElement('span');
                        tag.className = 'tag social-tag';
                        tag.textContent = `${escapeHtml(platform)}: ${escapeHtml(handle)}`;
                        socialContainer.appendChild(tag);
                    });

                    // Populate key members with XSS protection
                    const membersList = document.getElementById('keyMembersList');
                    orgData.keyMembers.forEach(member => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${escapeHtml(member.name)}</span>
                            <span class="member-role">${escapeHtml(member.role)}</span>
                        `;
                        membersList.appendChild(li);
                    });
                }

                function escapeHtml(text) {
                    if (typeof text !== 'string') return text;
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                // Modal functions
                function openEditModal() {
                    const orgName = document.getElementById('orgName').textContent;
                    const orgDesc = document.getElementById('orgDescription').textContent;
                    const president = document.getElementById('orgPresident').textContent;
                    const vp = document.getElementById('orgVP').textContent;
                    const email = document.getElementById('contactEmail').textContent;
                    
                    document.getElementById('editOrgName').value = orgName;
                    document.getElementById('editOrgDesc').value = orgDesc;
                    document.getElementById('editPresident').value = president;
                    document.getElementById('editVicePresident').value = vp;
                    document.getElementById('editContactEmail').value = email;
                    
                    document.getElementById('editModal').style.display = 'flex';
                }

                function closeEditModal() {
                    document.getElementById('editModal').style.display = 'none';
                }

                function saveOrgProfile() {
                    const newName = document.getElementById('editOrgName').value;
                    const newDesc = document.getElementById('editOrgDesc').value;
                    const newPresident = document.getElementById('editPresident').value;
                    const newVP = document.getElementById('editVicePresident').value;
                    const newEmail = document.getElementById('editContactEmail').value;
                    
                    if (!newName.trim() || !newDesc.trim() || !newPresident.trim() || !newVP.trim() || !newEmail.trim()) {
                        alert('All fields are required!');
                        return;
                    }
                    
                    if (!newEmail.includes('@')) {
                        alert('Please enter a valid email address');
                        return;
                    }
                    
                    document.getElementById('orgName').textContent = escapeHtml(newName);
                    document.getElementById('orgDescription').textContent = escapeHtml(newDesc);
                    document.getElementById('orgPresident').textContent = escapeHtml(newPresident);
                    document.getElementById('orgVP').textContent = escapeHtml(newVP);
                    document.getElementById('contactEmail').textContent = escapeHtml(newEmail);
                    
                    closeEditModal();
                    
                    // In a real app, you would save to backend here
                    alert('Profile updated successfully! (Changes are for demo only)');
                }

                function managePosts() {
                    const userInfo = AuthGuard.getCurrentUser();
                    if (userInfo && userInfo.isLoggedIn) {
                        window.location.href = 'org1.html';
                    } else {
                        window.location.href = 'login.html';
                    }
                }

                function viewAnalytics() {
                    alert('Opening analytics dashboard...');
                }

                function createNewPost() {
                    alert('Opening post creator...');
                }

                function manageEvents() {
                    alert('Opening event management...');
                }

                function viewMembers() {
                    alert('Opening members list...');
                }

                function downloadReports() {
                    alert('Downloading organization reports...');
                }

                window.addEventListener('click', function(event) {
                    const modal = document.getElementById('editModal');
                    if (event.target === modal) {
                        closeEditModal();
                    }
                });

                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape') {
                        closeEditModal();
                    }
                });
            </script>
        </main>
    </body>
</html>